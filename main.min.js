function activateStereoFallback(){console.log("---- activateStereoFallback"),effectCache?stereoEffect=effectCache:(stereoEffect=new THREE.StereoEffect(renderer),stereoEffect.eyeSeparation=1,effectCache=stereoEffect),resizeViewport(),fullscreen()}function init(){if(stereoEnabled&&WEBVR.isLatestAvailable()===!1&&!stereoFallbackEnabled,renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!1}),renderer.setSize(window.innerWidth,window.innerHeight),renderer.setPixelRatio(window.devicePixelRatio),scene=new THREE.Scene,camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1),sceneCube=new THREE.Scene,cameraCube=new THREE.PerspectiveCamera(70,window.innerWidth/window.innerHeight,1,1e5),stereoEnabled&&WEBVR.isLatestAvailable()===!1&&!stereoFallbackEnabled&&(camera.position.set(0,2,-1),camera.lookAt(new THREE.Vector3(0,1.6,0))),controls=new THREE.VRControls(camera),controls.standing=!0,vrEffect=new THREE.VREffect(renderer),navigator.getVRDisplays&&(navigator.getVRDisplays().then(function(e){effect.setVRDisplay(e[0]),controls.setVRDisplay(e[0])})["catch"](function(){}),document.body.appendChild(WEBVR.getButton(vrEffect))),stereoEnabled){if(WEBVR.isAvailable()===!0){var e=WEBVR.getButton(vrEffect);document.body.appendChild(e),isMobile&&(e.onclick=function(){console.log("---- button overrided!"),stereoFallbackEnabled=!0,activateStereoFallback()})}else stereoFallbackEnabled?(console.info("Fallback to StereoEffect"),stereoFallback=!0,activateStereoFallback()):isMobile&&activateStereoFallback();noSleep=new NoSleep}clock.autoStart=!0,directionalLight=new THREE.DirectionalLight(16777215,.5),directionalLight.position.set(2,20,0),scene.add(directionalLight);var t=new THREE.AmbientLight(16777215,1);scene.add(t),loadObjects();var o=.01,n=.05;ABSULIT.gamepad.init(["right","left","xbox"],function(e){var t=e.xbox,a=t.buttons,i=o;if(a.RT.pressed&&(i=n),a.LJX.pressed){var r=a.LJX.angle-PI_HALF;cameraPosition.z+=Math.cos(-cameraRotation.y+r)*i,cameraPosition.x-=Math.sin(-cameraRotation.y+r)*i}a.RJX.pressed&&(cameraRotation.y+=-a.RJX.x*i),a.UP.pressed&&(cameraPosition.z-=Math.cos(-cameraRotation.y)*i,cameraPosition.x+=Math.sin(-cameraRotation.y)*i),a.DOWN.pressed&&(cameraPosition.z-=Math.cos(-cameraRotation.y-2*PI_HALF)*i,cameraPosition.x+=Math.sin(-cameraRotation.y-2*PI_HALF)*i),a.LEFT.pressed&&(cameraPosition.z-=Math.cos(-cameraRotation.y-1*PI_HALF)*i,cameraPosition.x+=Math.sin(-cameraRotation.y-1*PI_HALF)*i),a.RIGHT.pressed&&(cameraPosition.z-=Math.cos(-cameraRotation.y+1*PI_HALF)*i,cameraPosition.x+=Math.sin(-cameraRotation.y+1*PI_HALF)*i),a.A.pressed&&(cameraPosition.y+=-i),a.Y.pressed&&(cameraPosition.y+=i),a.B.pressed&&!buttonPressed&&(console.log(cameraPosition),console.log(camera.rotation),console.log("\n")),a.LB.pressed&&!buttonPressed&&(cameraContainer.rotation.y+=PI_HALF),a.RB.pressed&&!buttonPressed&&(cameraContainer.rotation.y+=-PI_HALF),a.VIEW.pressed&&!buttonPressed&&controls.resetPose(),buttonPressed=a.RB.pressed||a.LB.pressed||a.B.pressed||a.Y.pressed||a.VIEW.pressed},function(){}),ABSULIT.teleportSpots.init(teleportSpots),ABSULIT.pointer.init(),ABSULIT.audioLoader.init();var a="textures/cube/hall/",i=[a+"posx.png",a+"negx.png",a+"posy.png",a+"negy.png",a+"posz.png",a+"negz.png"],r=new THREE.CubeTextureLoader(manager).load(i);r.format=THREE.RGBFormat,r.mapping=THREE.CubeReflectionMapping,CS.spheres.init(function(e){},r),CS.anim1.init(function(e){},r,clock),CS.mocap1.init(function(e){},r),CS.mocap2.init(function(e){},r),a="textures/cube/anim2/",i=[a+"posx.png",a+"negx.png",a+"posy.png",a+"negy.png",a+"posz.png",a+"negz.png"];var s=new THREE.CubeTextureLoader(manager).load(i);s.format=THREE.RGBFormat,s.mapping=THREE.CubeReflectionMapping,CS.anim2.init(function(e){},s,clock),ABSULIT.skysphere.init("textures/sky_sphere.jpg"),window.addEventListener("click",function(){noSleep.enable()}),window.addEventListener("resize",resizeViewport,!1),document.body.appendChild(renderer.domElement),resizeViewport()}function loadObjects(){loadObject(objectIndex,objectsToLoad)}function loadObject(e){objectIndex<objectsToLoad.length&&(ABSULIT.objects.init(objectsToLoad[objectIndex],loadObject),++objectIndex)}function update(){vrEffect.requestAnimationFrame(update),ABSULIT.gamepad.update(),ABSULIT.pointer.update(camera.position,camera.rotation),ABSULIT.teleportSpots.update(),ABSULIT.objects.update(),CS.spheres.update(),CS.anim1.update(),CS.anim2.update(),CS.mocap1.update(),CS.mocap2.update(),stereoEnabled?WEBVR.isAvailable()===!0?(stereoFallbackEnabled?stereoEffect.render(scene,camera):vrEffect.render(scene,camera),controls.update(cameraPosition,cameraRotation)):(stereoFallbackEnabled?stereoEffect.render(scene,camera):isMobile?stereoEffect.render(scene,camera):renderer.render(scene,camera),controls.update(cameraPosition,cameraRotation)):renderer.render(scene,camera),++frame}function fullscreen(){console.log("---- fullscreen"),document.body.requestFullscreen?document.body.requestFullscreen():renderer.domElement.msRequestFullscreen?window.msRequestFullscreen():renderer.domElement.mozRequestFullScreen?document.body.mozRequestFullScreen():renderer.domElement.webkitRequestFullscreen&&document.body.webkitRequestFullscreen()}const DracoModule=Module;var scene,camera,renderer,light,directionalLight,stereoEnabled=!0,stereoFallbackEnabled=!1,stereoFallback=!1,stereoEffect,vrEffect,effectCache,noSleep,clock=new THREE.Clock,cameraPosition=new THREE.Vector3,cameraRotation=new THREE.Vector3,cameraContainer=new THREE.Object3D,PI=Math.PI,PI_HALF=PI/2,frame=0,info=document.getElementsByClassName("info")[0],percent=document.getElementsByClassName("percent")[0],manager=new THREE.LoadingManager(function(){renderer.setClearColor(16777215),ABSULIT.objects.models.forEach(function(e){info.remove(),e.traverse(function(e){ABSULIT.teleportSpots.setEvents(e)})})});manager.onProgress=function(e,t,o){percent.innerHTML=Math.floor(t/o*100)+"%"};const loader=new THREE.OBJLoader(manager),mtlLoader=new THREE.MTLLoader(manager),textureLoader=new THREE.TextureLoader(manager),dracoLoader=new THREE.DRACOLoader,ctmLoader=new THREE.CTMLoader,plyLoader=new THREE.PLYLoader;loader.setPath("./models/"),mtlLoader.setPath("./models/"),dracoLoader.setPath("./models/");const userHeight=1.6,spotHeight=.22,teleportSpots=[{x:6,y:spotHeight,z:0},{x:-6,y:spotHeight,z:0},{x:6,y:spotHeight,z:-1},{x:3,y:spotHeight,z:-1},{x:0,y:spotHeight,z:-1},{x:-3,y:spotHeight,z:-1},{x:-6,y:spotHeight,z:-1},{x:6,y:spotHeight,z:1},{x:3,y:spotHeight,z:1},{x:0,y:spotHeight,z:1},{x:-3,y:spotHeight,z:1},{x:-6,y:spotHeight,z:1}];var resizeViewport=function(){camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),stereoEffect?stereoEffect.setSize(window.innerWidth,window.innerHeight):renderer.setSize(window.innerWidth,window.innerHeight)},toggleStereo=function(){stereoEnabled=!stereoEnabled,stereoEnabled?effectCache?stereoEffect=effectCache:(stereoEffect=new THREE.StereoEffect(renderer),stereoEffect.eyeSeparation=1,effectCache=stereoEffect):stereoEffect=null,resizeViewport()};window.mobileAndTabletcheck=function(){var e=!1;return function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),e};var isMobile=mobileAndTabletcheck(),buttonPressed=!1,ART_POINTER_TYPE=ABSULIT.teleportSpots.ART_POINTER_TYPE,objectsToLoad=[{file:"floor.obj",pointerType:null,normal:!0,shininess:10},{file:"hall.ply",pointerType:null,normal:!0,shininess:10},{file:"acropolis.obj",pointerType:null,normal:!1,shininess:null},{file:"castle_lake.obj",pointerType:null,normal:!1,shininess:null},{file:"good_samaritan.obj",pointerType:null,normal:!1,shininess:null},{file:"moonlight.obj",pointerType:null,normal:!1,shininess:null},{file:"podiums.obj",pointerType:null,normal:!1,shininess:null},{file:"lamps.obj",pointerType:null,normal:!1,shininess:null,side:THREE.DoubleSide},{file:"david.ctm",pointerType:ART_POINTER_TYPE,normal:!1,shininess:0},{file:"female_head.ctm",pointerType:ART_POINTER_TYPE,normal:!0,shininess:null},{file:"lion.ctm",pointerType:ART_POINTER_TYPE,normal:!0,shininess:null},{file:"greek_bust.ctm",pointerType:ART_POINTER_TYPE,normal:!0,shininess:null},{file:"old_man.ctm",pointerType:ART_POINTER_TYPE,normal:!1,shininess:null},{file:"nefertiti.ctm",pointerType:ART_POINTER_TYPE,normal:!1,shininess:0},{file:"fractal_1.obj",pointerType:ART_POINTER_TYPE,normal:!1,shininess:0},{file:"fractal_2.obj",pointerType:ART_POINTER_TYPE,normal:!1,shininess:10},{file:"fractal_3.obj",pointerType:ART_POINTER_TYPE,normal:!1,shininess:0},{file:"female_helmet.obj",pointerType:ART_POINTER_TYPE,normal:!1,shininess:10},{file:"monk_uv.ctm",pointerType:ART_POINTER_TYPE,normal:!1,shininess:10},{file:"david_bike_hall_3.obj",pointerType:ART_POINTER_TYPE,normal:!1,shininess:null,side:THREE.DoubleSid}],objectIndex=0;init(),update();